
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monica - State Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --font-sans: 'Inter', sans-serif; --font-mono: 'Roboto Mono', monospace; --color-bg: #0a0a0f; --color-pane: rgba(23, 26, 43, 0.5); --color-border: rgba(129, 140, 248, 0.2); --color-neon-indigo: rgba(129, 140, 248, 1); --color-neon-cyan: rgba(34, 211, 238, 1); }
        body { font-family: var(--font-sans); background-color: var(--color-bg); color: #d1d5db; }
        .glass-pane { background-color: var(--color-pane); backdrop-filter: blur(16px) saturate(180%); -webkit-backdrop-filter: blur(16px) saturate(180%); border: 1px solid var(--color-border); }
        .neon-glow-indigo { box-shadow: 0 0 5px rgba(129, 140, 248, 0.6), 0 0 10px rgba(129, 140, 248, 0.4); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
        @keyframes animated-gradient-text { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: rgba(129, 140, 248, 0.4); border-radius: 4px; } ::-webkit-scrollbar-thumb:hover { background: rgba(129, 140, 248, 0.6); }
        .prose-docs { --tw-prose-body: #d1d5db; --tw-prose-headings: #ffffff; --tw-prose-lead: #a5b4fc; --tw-prose-links: #c7d2fe; --tw-prose-bold: #ffffff; --tw-prose-counters: #a5b4fc; --tw-prose-bullets: #a5b4fc; --tw-prose-hr: rgba(255, 255, 255, 0.2); --tw-prose-quotes: #e5e7eb; --tw-prose-quote-borders: #a5b4fc; --tw-prose-captions: #9ca3af; --tw-prose-code: #c7d2fe; --tw-prose-pre-code: #c7d2fe; --tw-prose-pre-bg: rgba(0, 0, 0, 0.3); }
        .nav-link.active { background-color: rgba(129, 140, 248, 0.3); border-left-color: var(--color-neon-indigo); color: #fff; box-shadow: 0 0 8px rgba(129, 140, 248, 0.5); }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <audio id="click-sound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU9vT19PAAAAAAACAgIAAASEgAABIYAICwgJAgALLgUIiAECCw8JEgABCIYACAwFCIsABQYHCQoBBAkJCAACCQkIAAMJCQgABQkJCQAHCQkIAAgJCQkACQkJCQAJCQkIAAYJCQkAAwkJCQADCQkJAAYJCQkABQkJCAADCQkJAAQJCQgABAkJCAAECAgIAAMICAgAAgYFAgACBQQEAAIEAwMAAgQDAwACBAMDAAIEAwIAAgQDAgACBAMCAAIEAwIAAgQDAgACBAMCAAIEAwIAAgQCAgADAgEBAAACAQECAAICAgACAgECAAICAgACAgICAAICAgACAgICAAICAgACAgICAAICAgACAgICAAICAgACAgICAAICAgACAgECAAICAQIAAQEBAgABAQIAAAEBAQAAAQEBAAABAQEAAAABAAAAAAEBAQAAAQEBAAABAQEAAAABAQEAAAABAQEAAAABAQAAAQAAAAEBAQAAAQEBAAABAQEAAAABAQAAAQAAAAEBAQAAAQEBAAABAQAAAQAAAAEBAQAAAQEBAAABAQEAAAABAQEAAAABAQAAAQAAAAEAAQAA" preload="auto"></audio>
    <div class="max-w-screen-xl mx-auto">
        <header class="text-center mb-12 animate-fade-in-up">
            <a href="./index.html" class="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-cyan-400 to-indigo-400" style="background-size: 200% 200%; animation: animated-gradient-text 5s ease infinite;">
                Monica
            </a>
            <p class="text-xl text-gray-400 mt-2">Project Documentation</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <nav id="docs-nav" class="lg:col-span-1 glass-pane rounded-xl p-6 self-start animate-fade-in-up" style="animation-delay: 0.2s;">
                <h2 class="text-lg font-semibold mb-4 text-white">Documentation Index</h2>
                <ul class="space-y-2">
                    <li><a href="./README.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">Project Overview</a></li>
                    <li><a href="./architecture.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">Architecture Guide</a></li>
                    <li><a href="./development_cycle.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">Development Cycle</a></li>
                    <li><a href="./state_management.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">State Management</a></li>
                    <li><a href="./services.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">Services & API</a></li>
                    <li><a href="./components.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">Component Library</a></li>
                    <li><a href="./styling_guide.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">Styling Guide</a></li>
                    <li><a href="./database_migration_plan.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">Database Migration</a></li>
                    <li><a href="./future_features_with_backend.html" class="nav-link block p-3 rounded-lg border-l-4 border-transparent transition-all hover:bg-white/10">Future Vision</a></li>
                </ul>
            </nav>
            <main id="docs-content" class="lg:col-span-3 glass-pane rounded-xl p-8 animate-fade-in-up" style="animation-delay: 0.4s;">
                <div class="prose prose-docs max-w-none">
                    <h1>State Management</h1>
                    <p class="lead">Monica uses a clean, hooks-based state management architecture built on React Context. This provides a scalable and maintainable way to manage application state without introducing external libraries.</p>

                    <h2>The Core: <code>StateProvider.tsx</code></h2>
                    <p>The entire state management system is orchestrated from <code>contexts/StateProvider.tsx</code>. This file serves as the central hub for the application's data and logic.</p>
                    
                    <h3>Key Responsibilities:</h3>
                    <ul>
                        <li><strong>State Initialization:</strong> It initializes all core, persistent application state using the <code>useLocalStorage</code> hook. This includes agents, agent manager settings, conversations, and user preferences.</li>
                        <li><strong>Logic Assembly:</strong> It brings together all the business logic, which is encapsulated in domain-specific custom hooks.</li>
                        <li><strong>Context Provision:</strong> It creates the main <code>AppContext</code> and provides a single, unified value containing all state and dispatch functions to the entire component tree.</li>
                    </ul>

                    <h2>The Logic Domains: Custom Hooks</h2>
                    <p>Instead of a single, monolithic state file, logic is segregated into custom hooks based on their domain of responsibility. This adheres to the Single Responsibility Principle and makes the codebase much easier to navigate and test.</p>

                    <div class="space-y-4">
                        <div class="glass-pane -m-2 p-3 rounded-lg">
                            <h4><code>useConversationManager</code></h4>
                            <p>Manages the lifecycle of conversations. Its responsibilities include creating, deleting, selecting, updating, and generating titles for conversations. It also handles the import/export functionality and standard message actions like bookmarking, deleting, and editing.</p>
                        </div>
                        <div class="glass-pane -m-2 p-3 rounded-lg">
                            <h4><code>useChatHandler</code></h4>
                            <p>This is the most complex hook and contains the core chat orchestration logic. It manages loading states, determines the chat flow based on the current mode (Dynamic, AI, Manual, Moderated), and calls the appropriate services to get AI responses. It also handles streaming responses and AI-powered message actions (summarize, rewrite, regenerate).</p>
                        </div>
                        <div class="glass-pane -m-2 p-3 rounded-lg">
                            <h4><code>useHistoryHandler</code></h4>
                            <p>Manages the logic for generating the structured conversation history view, including creating summaries and identifying topics.</p>
                        </div>
                        <div class="glass-pane -m-2 p-3 rounded-lg">
                            <h4><code>useModalManager</code></h4>
                            <p>Centralizes the state for all modals and panels in the application (Settings, History, Agent Stats, etc.). This prevents prop-drilling of `isOpen` and `setIsOpen` states throughout the component tree.</p>
                        </div>
                        <div class="glass-pane -m-2 p-3 rounded-lg">
                            <h4><code>useUsageTracker</code></h4>
                            <p>Handles the client-side estimation and persistence of API usage metrics, including daily and per-agent breakdowns.</p>
                        </div>
                        <div class="glass-pane -m-2 p-3 rounded-lg">
                            <h4><code>useMemoryManager</code></h4>
                            <p>Manages the state and persistence of the AI's long-term memory, including the logic for clearing it.</p>
                        </div>
                    </div>

                    <h2 class="!mt-8">Consuming State: <code>useAppContext</code></h2>
                    <p>Components access the state and dispatch functions through a single, simple hook: <code>useAppContext()</code>. This hook provides access to the entire state object defined in the provider, abstracting away the underlying complexity.</p>
                    <pre><code>import { useAppContext } from './contexts/StateProvider.tsx';

const MyComponent = () => {
  // Access any part of the global state with one line
  const { activeConversation, handleNewConversation, isLoading } = useAppContext();

  return (
    &lt;div&gt;
      &lt;p&gt;{isLoading ? 'Loading...' : activeConversation?.title}&lt;/p&gt;
      &lt;button onClick={handleNewConversation}&gt;New Chat&lt;/button&gt;
    &lt;/div&gt;
  );
}
</code></pre>

                </div>
            </main>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const audio = document.getElementById('click-sound');
            document.querySelectorAll('a, button').forEach(el => {
                el.addEventListener('click', () => {
                    if (audio && audio.play) {
                        audio.currentTime = 0;
                        audio.play().catch(e => {});
                    }
                });
            });
            const navLinks = document.querySelectorAll('.nav-link');
            const setActiveLink = (link) => {
                if (!link) return;
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
            };
            const currentPath = window.location.pathname.split('/').pop() || 'README.html';
            const activeLink = document.querySelector(`.nav-link[href$="${currentPath}"]`);
            setActiveLink(activeLink || document.querySelector('.nav-link'));
        });
    </script>
</body>
</html>
